---
phase: 03-image-optimization
plan: 04
type: execute
wave: 4
depends_on: ["03-03"]
files_modified:
  - index.html
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All srcset entries reference files that actually exist"
    - "Logo fallback uses WebP instead of non-existent JPEG"
    - "No 404 errors when browser requests srcset variants"
  artifacts:
    - path: "index.html"
      provides: "Fixed srcset and logo fallback references"
  key_links:
    - from: "index.html"
      to: "images-optimized/avif/"
      via: "srcset references"
      pattern: "srcset.*avif"
    - from: "index.html"
      to: "images-optimized/webp/full/cassiecaylogobw2.webp"
      via: "img src fallback"
      pattern: "cassiecaylogobw2.webp"
---

<objective>
Fix HTML srcset references and logo fallback to match existing optimized files

Purpose: Close gaps identified in Phase 03 verification. The HTML currently references 1200w and 1800w srcset variants for portfolio images that don't exist (source images were smaller than 1200px, so optimization script correctly skipped upscaling). The logo fallback references a non-existent JPEG (PNG with transparency correctly skipped JPEG generation).

Output:
- Updated index.html with corrected srcset entries (800w only for portfolio thumbnails)
- Updated logo img src to use WebP instead of JPEG
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/roadmap/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-image-optimization/03-VERIFICATION.md
@.planning/phases/03-image-optimization/03-03-SUMMARY.md

# Current HTML with issues
@index.html

# Verify what files exist
Only these 6 images have 1200w/1800w variants:
- cassiecay-background1, cassiecay-background2, cassiecay-background3
- cassiecay-slider2, cassiecay-slider4, cassiecay-slider7

All other portfolio images only have full/ and 800w/ variants.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix portfolio image srcset entries</name>
  <files>index.html</files>
  <action>
Update portfolio image srcset attributes to only reference widths that exist.

**Current pattern (broken):**
```html
<source
  srcset="images-optimized/avif/800w/cassiecay-F1.avif 800w,
          images-optimized/avif/1200w/cassiecay-F1.avif 1200w,
          images-optimized/avif/1800w/cassiecay-F1.avif 1800w"
  sizes="(max-width: 600px) 100vw, (max-width: 1200px) 50vw, 400px"
  type="image/avif">
```

**Fixed pattern (800w only for portfolio):**
```html
<source
  srcset="images-optimized/avif/800w/cassiecay-F1.avif 800w"
  sizes="(max-width: 600px) 100vw, (max-width: 1200px) 50vw, 400px"
  type="image/avif">
```

**Images that need srcset reduced to 800w only:**
These 9 portfolio images have 1200w/1800w in srcset but those files don't exist:
- cassiecay-F1
- cassiecay-F10
- cassiecay-F15
- cassiecay-M8
- cassiecay-E4
- cassiecay-E5
- cassiecay-E13-full
- cassiecay-NB4-crop
- cassiecay-NB7-crop

For each of these images, update ALL three source/img elements (AVIF, WebP, JPEG) to use 800w only srcset.

**DO NOT change these images (they have 1200w/1800w variants):**
- cassiecay-slider2, cassiecay-slider7 (hero slider)
- cassiecay-background1, cassiecay-background2, cassiecay-background3 (backgrounds)

Note: The slider images use 1800w directly in src, not srcset, so they're fine.
  </action>
  <verify>
```bash
# Should return 0 matches for portfolio images (only slider/background should have 1200w/1800w)
grep -E 'cassiecay-(F1|F10|F15|M8|E4|E5|E13-full|NB4-crop|NB7-crop)\.avif 1200w' index.html | wc -l
# Expected: 0

# Should still have 800w references
grep -c 'cassiecay-F1.avif 800w' index.html
# Expected: 1
```
  </verify>
  <done>
Portfolio image srcset entries only reference 800w width variant.
No srcset references to 1200w or 1800w for images that don't have those variants.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix logo fallback to use WebP instead of JPEG</name>
  <files>index.html</files>
  <action>
Update the logo image fallback from non-existent JPEG to existing WebP.

The logo (cassiecaylogobw2.png) has transparency (alpha channel), so the optimization script correctly skipped JPEG generation. The WebP version exists and supports transparency.

**Current (broken - file doesn't exist):**
```html
<picture>
  <source srcset="images-optimized/avif/full/cassiecaylogobw2.avif" type="image/avif">
  <source srcset="images-optimized/webp/full/cassiecaylogobw2.webp" type="image/webp">
  <img src="images-optimized/jpeg/full/cassiecaylogobw2.jpg" alt="Cassie Cay Photography logo">
</picture>
```

**Fixed (uses WebP fallback which exists and supports transparency):**
```html
<picture>
  <source srcset="images-optimized/avif/full/cassiecaylogobw2.avif" type="image/avif">
  <source srcset="images-optimized/webp/full/cassiecaylogobw2.webp" type="image/webp">
  <img src="images-optimized/webp/full/cassiecaylogobw2.webp" alt="Cassie Cay Photography logo">
</picture>
```

There are 2 logo instances in index.html (header and footer). Update both.

**Lines to update:**
- Line 115 (header logo)
- Line 1359 (footer logo)
  </action>
  <verify>
```bash
# Should return 0 matches
grep 'cassiecaylogobw2.jpg' index.html | wc -l
# Expected: 0

# Should return 2 matches (header + footer)
grep 'cassiecaylogobw2.webp.*alt="Cassie Cay Photography logo"' index.html | wc -l
# Expected: 2
```
  </verify>
  <done>
Logo img src uses WebP fallback instead of non-existent JPEG.
Both header and footer logo instances updated.
Transparency preserved in fallback format.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Verify no references to non-existent files:
```bash
# Check no portfolio images have 1200w/1800w in srcset
for img in cassiecay-F1 cassiecay-F10 cassiecay-F15 cassiecay-M8 cassiecay-E4 cassiecay-E5 cassiecay-E13-full cassiecay-NB4-crop cassiecay-NB7-crop; do
  count=$(grep -c "${img}.*1200w" index.html || true)
  if [ "$count" != "0" ]; then
    echo "ERROR: ${img} still has 1200w reference"
  fi
done

# Check logo JPEG is gone
grep 'cassiecaylogobw2.jpg' index.html && echo "ERROR: logo JPEG still referenced" || echo "OK: logo JPEG removed"
```

2. Verify site still works:
```bash
npm run build
npm run preview
```
Open http://localhost:4173 and verify:
- Logo displays correctly (with transparency)
- Portfolio gallery images load (no 404 errors in console)
- Browser DevTools Network tab shows no 404s for image files

3. Re-run verification:
The phase should now pass verification with 5/5 truths verified.
</verification>

<success_criteria>
1. No srcset references to 1200w or 1800w for images that don't have those variants
2. Logo fallback uses WebP (not JPEG) to preserve transparency
3. `npm run build` completes successfully
4. No 404 errors in browser DevTools when viewing site
5. All images display correctly
</success_criteria>

<output>
After completion, create `.planning/phases/03-image-optimization/03-04-SUMMARY.md`

Include:
- Confirmation that gaps are closed
- Count of srcset entries fixed
- Verification that no 404s occur
</output>
