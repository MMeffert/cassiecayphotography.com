---
phase: 19-ai-alt-text
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [package.json, scripts/generate-alt-text.js, index.html]
autonomous: false

must_haves:
  truths:
    - "All 84 portfolio images in index.html have non-empty alt attributes"
    - "Alt text describes image content with Madison, WI location keyword"
    - "Alt text includes photography service type (family, wedding, etc.)"
  artifacts:
    - path: "scripts/generate-alt-text.js"
      provides: "Claude Vision API alt text generator"
      exports: ["generateAltText"]
      min_lines: 100
    - path: "alt-text.json"
      provides: "Alt text manifest for review"
      contains: ["cassiecay-F1", "cassiecay-NB", "Madison"]
    - path: "index.html"
      provides: "Updated portfolio with alt text"
      contains_none: ['alt=""']
  key_links:
    - from: "scripts/generate-alt-text.js"
      to: "Anthropic API"
      via: "@anthropic-ai/sdk"
      pattern: "new Anthropic"
    - from: "alt-text.json"
      to: "index.html"
      via: "script injection"
      pattern: "alt=\"[^\"]+\""
---

<objective>
Generate descriptive, SEO-optimized alt text for all 84 portfolio images using Claude Vision API.

Purpose: Empty alt attributes hurt both accessibility and SEO. Claude Vision can generate descriptive, contextually accurate alt text that includes location keywords (Madison, WI) and service type (family photography, wedding, etc.).

Output: Script generates alt-text.json manifest for review, then injects alt text into index.html.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@package.json
@index.html (lines 330-400 for image structure)
@scripts/generate-sitemap.js (for code style reference)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create alt text generation script</name>
  <files>package.json, scripts/generate-alt-text.js</files>
  <action>
**Step 1: Install Anthropic SDK**

```bash
npm install --save-dev @anthropic-ai/sdk
```

**Step 2: Create scripts/generate-alt-text.js**

Create a Node.js ESM script that:

1. **Extracts portfolio images from index.html** by parsing for `<img>` tags with `alt=""` and `src` containing `cassiecay-`:
   - Pattern: `<img src="images-optimized/jpeg/800w/cassiecay-*.jpg"` with `alt=""`
   - Extract the filename to identify the image

2. **For each image, calls Claude Vision API** to generate alt text:
   - Use claude-sonnet-4-20250514 model (vision-capable, cost-effective)
   - Send the 800w JPEG image (smallest variant, ~30KB each)
   - Prompt instructs Claude to:
     - Describe the image in 10-20 words
     - Include photography service type based on filename prefix (F=Family, W=Wedding, etc.)
     - Include "Madison, WI" or "Madison, Wisconsin" location naturally
     - Focus on subjects, setting, and emotion
     - Avoid starting with "A photo of" or "An image of"

3. **Rate limiting and batching**:
   - Process 5 images concurrently (p-limit)
   - Add 200ms delay between batches to avoid rate limits
   - Total: ~84 images × $0.003-0.004/image ≈ $0.29

4. **Outputs alt-text.json manifest**:
   ```json
   {
     "generated": "2026-01-21T...",
     "model": "claude-sonnet-4-20250514",
     "images": [
       {
         "filename": "cassiecay-F1.jpg",
         "fullPath": "images-optimized/jpeg/800w/cassiecay-F1.jpg",
         "category": "Family",
         "altText": "Mother and daughter laughing together in autumn leaves at Madison, WI park"
       }
     ]
   }
   ```

**Claude Vision prompt:**

```
You are generating alt text for a professional photography portfolio website.

Image context:
- Photographer: Cassie Cay Photography
- Location: Madison, Wisconsin
- Category: {category} photography

Generate concise alt text (10-20 words) that:
1. Describes the subjects and setting
2. Conveys the mood/emotion
3. Naturally includes "Madison, WI" or "Madison, Wisconsin"
4. Mentions the photography type ({category} portrait/photography)
5. Does NOT start with "A photo of" or "An image of"

Respond with ONLY the alt text, no quotes or explanation.
```

**Script structure:**

```javascript
import Anthropic from '@anthropic-ai/sdk';
import { readFileSync, writeFileSync, existsSync } from 'fs';
import { resolve } from 'path';
import pLimit from 'p-limit';

const ANTHROPIC_API_KEY = process.env.ANTHROPIC_API_KEY;
const MODEL = 'claude-sonnet-4-20250514';

const CATEGORY_MAP = {
  'F': 'Family',
  'B': 'Bridal',
  'C': 'Corporate',
  'E': 'Event',
  'S': 'Senior',
  'W': 'Wedding',
  'NB': 'Newborn',
  'M': 'Milestone',
  'senior': 'Senior'
};

async function extractImagesFromHtml() {
  // Parse index.html for img tags with alt="" and cassiecay- src
}

async function generateAltTextForImage(client, imagePath, category) {
  // Read image, base64 encode, call Claude Vision
}

async function generateAltText() {
  // Main orchestration
}

generateAltText();
```

**Important notes:**
- Requires ANTHROPIC_API_KEY environment variable
- Uses existing p-limit package (already installed)
- Match code style of other scripts
- Handle API errors gracefully with retry logic
  </action>
  <verify>
1. `npm install` completes without errors
2. `ls node_modules/@anthropic-ai/sdk` confirms package installed
3. Script syntax is valid: `node --check scripts/generate-alt-text.js`
  </verify>
  <done>
- @anthropic-ai/sdk installed as devDependency
- scripts/generate-alt-text.js created with correct structure
- Script parses index.html for images and calls Claude Vision API
  </done>
</task>

<task type="checkpoint">
  <name>Task 2: Generate alt text manifest</name>
  <files>alt-text.json</files>
  <action>
Run the alt text generation script:

```bash
ANTHROPIC_API_KEY=$(security find-generic-password -a "claude" -s "ANTHROPIC_API_KEY" -w) node scripts/generate-alt-text.js
```

This will:
1. Extract 84 images from index.html
2. Call Claude Vision API for each image
3. Generate alt-text.json manifest

**Review the output:**
- Check that alt text is descriptive and accurate
- Verify Madison, WI is included naturally
- Ensure service type is mentioned
- Confirm no generic or repetitive descriptions

**Sample expected output:**
```json
{
  "images": [
    {
      "filename": "cassiecay-F1.jpg",
      "category": "Family",
      "altText": "Joyful family of four posing in autumn foliage at Madison, WI park"
    },
    {
      "filename": "cassiecay-W1.jpg",
      "category": "Wedding",
      "altText": "Bride and groom sharing first dance at elegant Madison, Wisconsin reception"
    }
  ]
}
```
  </action>
  <checkpoint_question>
Review alt-text.json - are the generated alt texts descriptive, accurate, and include location/service keywords?
  </checkpoint_question>
  <verify>
1. alt-text.json exists with 84 image entries
2. Each entry has non-empty altText field
3. Alt text mentions Madison, WI or Wisconsin
4. Alt text is descriptive (not just "person standing")
  </verify>
  <done>
- alt-text.json generated with 84 entries
- Alt text reviewed and approved
- Ready for HTML injection
  </done>
</task>

<task type="auto">
  <name>Task 3: Inject alt text into HTML</name>
  <files>index.html, scripts/generate-alt-text.js</files>
  <action>
Add an injection mode to the script or create a separate injection step:

```bash
node scripts/generate-alt-text.js --inject
```

**Injection logic:**
1. Read alt-text.json manifest
2. Read index.html
3. For each image in manifest:
   - Find the `<img src="images-optimized/jpeg/800w/{filename}"` tag
   - Replace `alt=""` with `alt="{altText}"`
   - Escape any quotes in alt text
4. Write updated index.html

**Verification:**
```bash
# Count remaining empty alt attributes
grep -c 'alt=""' index.html

# Should be 0 for portfolio images (may have some for non-portfolio images)

# Verify alt text is present
grep -o 'alt="[^"]*Madison[^"]*"' index.html | head -5
```
  </action>
  <verify>
1. index.html updated with alt text
2. `grep -c 'alt=""' index.html` returns 0 or only non-portfolio images
3. Portfolio images have descriptive alt text with Madison, WI
4. No broken HTML or escaped quote issues
  </verify>
  <done>
- All portfolio images have non-empty alt attributes
- Alt text includes Madison, WI location
- Alt text includes photography service type
- HTML is valid (no quote escaping issues)
  </done>
</task>

</tasks>

<verification>
Phase 19 requirements satisfied:
- SEO-11: Alt text generation script using Claude Vision API
- SEO-12: Generated for all 84 portfolio images
- SEO-13: Includes location (Madison, WI) and service keywords
- SEO-14: HTML updated with generated alt text
</verification>

<success_criteria>
1. scripts/generate-alt-text.js exists and runs without errors
2. alt-text.json contains 84 entries with descriptive alt text
3. All portfolio images in index.html have non-empty alt attributes
4. Alt text includes "Madison, WI" or "Madison, Wisconsin" naturally
5. Alt text mentions photography type (family, wedding, etc.)
6. No `alt=""` on portfolio images
</success_criteria>

<output>
After completion, create `.planning/phases/19-ai-alt-text/19-01-SUMMARY.md`
</output>
