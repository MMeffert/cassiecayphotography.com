---
phase: 08-library-modernization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - index.html
  - style/js/custom-scripts.js
  - style/css/glightbox.css
autonomous: true

must_haves:
  truths:
    - "Clicking portfolio image opens GLightbox lightbox"
    - "Prev/next navigation works in lightbox"
    - "Escape key closes lightbox"
    - "Cubeportfolio filter then click opens lightbox correctly"
  artifacts:
    - path: "style/css/glightbox.css"
      provides: "GLightbox styling"
      min_lines: 50
    - path: "style/js/custom-scripts.js"
      provides: "GLightbox initialization"
      contains: "GLightbox"
  key_links:
    - from: "index.html"
      to: "style/css/glightbox.css"
      via: "link tag"
      pattern: "glightbox"
    - from: "style/js/custom-scripts.js"
      to: ".light-gallery a"
      via: "GLightbox selector"
      pattern: "GLightbox.*selector"
---

<objective>
Replace LightGallery with GLightbox for the portfolio lightbox functionality.

Purpose: LightGallery is included in custom-plugins.js (~25KB contribution). GLightbox is a lightweight alternative (~11KB) that provides the same features without jQuery dependency, setting up for potential future jQuery removal.

Output: Working portfolio lightbox using GLightbox with fade transitions, keyboard navigation, and Cubeportfolio filter compatibility.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/roadmap/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-library-modernization/08-RESEARCH.md

@index.html (lines 243-320 - portfolio section with light-gallery class)
@style/js/custom-scripts.js (lines 69-133 - LightGallery initialization)
@style/js/custom-plugins.js (contains LightGallery code)
@package.json
@vite.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install GLightbox and add CSS</name>
  <files>package.json, style/css/glightbox.css, index.html</files>
  <action>
1. Install GLightbox:
   ```bash
   npm install glightbox
   ```

2. Copy GLightbox CSS to style/css/glightbox.css from node_modules/glightbox/dist/css/glightbox.min.css

3. Add GLightbox CSS link to index.html before style.css:
   ```html
   <link rel="stylesheet" type="text/css" href="style/css/glightbox.css">
   ```

Note: Using local copy instead of CDN for consistency with existing asset management.
  </action>
  <verify>
- `npm ls glightbox` shows package installed
- `style/css/glightbox.css` exists and has content
- `grep glightbox index.html` shows CSS link tag
  </verify>
  <done>GLightbox package installed and CSS added to page</done>
</task>

<task type="auto">
  <name>Task 2: Replace LightGallery initialization with GLightbox</name>
  <files>style/js/custom-scripts.js, style/js/custom-plugins.js, vite.config.js</files>
  <action>
1. In custom-scripts.js, replace the LIGHTGALLERY section (lines 69-86) with GLightbox:

   ```javascript
   /*-----------------------------------------------------------------------------------*/
   /*	GLIGHTBOX (replaced LightGallery)
   /*-----------------------------------------------------------------------------------*/
   var lightbox = GLightbox({
       selector: '.light-gallery a',
       touchNavigation: true,
       loop: true,
       closeOnOutsideClick: true,
       keyboardNavigation: true,
       slideEffect: 'fade'
   });
   ```

2. Replace the Cubeportfolio "onAfterLoadMore" handler (lines 112-133) to use GLightbox reload:

   ```javascript
   $cubemosaic.on('onAfterLoadMore.cbp', function(event, newItemsAddedToGrid) {
       $('.cbp-item-load-more .overlay > a, .cbp-item-load-more .overlay > span').prepend('<span class="bg"></span>');
       // Reload GLightbox to pick up new images
       lightbox.reload();
   });
   ```

3. Also add reload on filter complete (new addition for robustness):

   ```javascript
   $cubemosaic.on('onFilterComplete.cbp', function() {
       lightbox.reload();
   });
   ```

4. Remove LightGallery from custom-plugins.js:
   - Search for "lightGallery" in custom-plugins.js
   - Remove the entire LightGallery code block (likely ~500-1000 lines)
   - Keep all other plugins (SmartMenus, Headhesive, Swiper, Cubeportfolio, etc.)

5. Add GLightbox JS to HTML (before custom-scripts.js):
   Add script tag in index.html before custom-plugins.js:
   ```html
   <script src="node_modules/glightbox/dist/js/glightbox.min.js"></script>
   ```

   OR copy to style/js/glightbox.min.js and reference:
   ```html
   <script src="style/js/glightbox.min.js"></script>
   ```

6. Update vite.config.js to copy glightbox files:
   Add to viteStaticCopy targets:
   ```javascript
   {
     src: 'style/js/glightbox.min.js',
     dest: 'style/js'
   },
   {
     src: 'style/css/glightbox.css',
     dest: 'style/css'
   },
   ```

Note: GLightbox is a standalone vanilla JS library, no jQuery dependency. The selector `.light-gallery a` matches existing HTML structure.
  </action>
  <verify>
- `grep -n "GLightbox" style/js/custom-scripts.js` shows initialization
- `grep -n "lightGallery" style/js/custom-scripts.js` returns nothing (removed)
- `grep -n "lightGallery" style/js/custom-plugins.js` returns nothing or significantly reduced
- `npm run build` succeeds
  </verify>
  <done>
- LightGallery code removed from custom-scripts.js
- LightGallery code removed from custom-plugins.js
- GLightbox initialization added with fade transition
- Cubeportfolio compatibility maintained via reload()
  </done>
</task>

<task type="auto">
  <name>Task 3: Test lightbox functionality</name>
  <files>None (testing only)</files>
  <action>
1. Run dev server:
   ```bash
   npm run dev
   ```

2. Open browser to http://localhost:3000

3. Test portfolio lightbox:
   - Click any portfolio image
   - Verify lightbox opens with fade transition
   - Use arrow keys to navigate between images
   - Press Escape to close
   - Verify clicking outside closes lightbox

4. Test with Cubeportfolio filtering:
   - Click a filter category (e.g., "Family")
   - Click an image in filtered view
   - Verify lightbox opens and navigation works within filtered set
   - Click "All" filter
   - Click an image
   - Verify all images are navigable

5. Test "Load More" if present:
   - If there's a load more button, click it
   - Click newly loaded images
   - Verify lightbox works

6. Run production build and test:
   ```bash
   npm run build
   npm run preview
   ```
   - Verify lightbox works in production build

7. Check console for errors:
   - No JavaScript errors in console
   - No missing resource warnings
  </action>
  <verify>
- `npm run dev` starts successfully
- `npm run build` completes without errors
- Browser console shows no JS errors
- Lightbox opens on image click
- Keyboard navigation (arrows, escape) works
- Filter + click works
  </verify>
  <done>
- GLightbox working in development mode
- GLightbox working in production build
- No console errors
- All lightbox features functional (open, navigate, close)
- Cubeportfolio filter compatibility confirmed
  </done>
</task>

</tasks>

<verification>
1. Lightbox opens on any portfolio image click
2. Prev/next navigation works with arrow keys
3. Escape closes lightbox
4. Clicking outside closes lightbox
5. Cubeportfolio filtering + lightbox works together
6. No console errors
7. Production build works (`npm run build && npm run preview`)
</verification>

<success_criteria>
- LightGallery completely removed from codebase
- GLightbox providing equivalent functionality
- custom-plugins.js size reduced (LightGallery was ~500 lines)
- No visual or functional regression in lightbox behavior
- All tests pass: `npm run build`
</success_criteria>

<output>
After completion, create `.planning/phases/08-library-modernization/08-01-SUMMARY.md`
</output>
