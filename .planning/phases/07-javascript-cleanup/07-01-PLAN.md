---
phase: 07-javascript-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - style/js/custom-plugins.js
  - style/js/custom-scripts.js
  - vite.config.js
  - index.html
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Site loads without JavaScript console errors"
    - "Portfolio lightbox opens and navigates images"
    - "Quote slider (Swiper) cycles through testimonials"
    - "Sticky header activates on scroll"
    - "Hamburger menu toggles on mobile"
    - "Portfolio grid filters and animates correctly"
    - "Scroll navigation smooth scrolls to sections"
  artifacts:
    - path: "style/js/custom-plugins.js"
      provides: "Extracted plugins bundle (only used plugins)"
      min_lines: 50
    - path: "style/js/custom-scripts.js"
      provides: "Trimmed initialization code (only used features)"
      min_lines: 30
  key_links:
    - from: "index.html"
      to: "style/js/custom-plugins.js"
      via: "script tag"
      pattern: "custom-plugins\\.js"
    - from: "index.html"
      to: "style/js/custom-scripts.js"
      via: "script tag"
      pattern: "custom-scripts\\.js"
    - from: "vite.config.js"
      to: "style/js/custom-plugins.js"
      via: "static copy target"
      pattern: "custom-plugins\\.js"
---

<objective>
Create optimized JavaScript bundles by extracting only the plugins and initialization code actually used by the site.

Purpose: Reduce JavaScript bundle size by ~60% (from 608KB to ~245KB) while preserving all existing functionality. This addresses PERF-03 and FRONT-03 requirements.

Output: `custom-plugins.js` and `custom-scripts.js` files containing only used code, wired into the build system.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/roadmap/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-javascript-cleanup/07-RESEARCH.md

# Key existing files
@vite.config.js
@index.html
@style/js/plugins.js
@style/js/scripts.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create custom-plugins.js with only required plugins</name>
  <files>style/js/custom-plugins.js</files>
  <action>
Extract ONLY these plugins from plugins.js into a new custom-plugins.js file:

**Required plugins (extract in this order):**
1. SmartMenus (includes Bootstrap addon and custom mod) - for navbar dropdowns
2. Headhesive (sticky header) - for fixed nav on scroll
3. jQuery Easing - for smooth scroll easing
4. Swiper - for quote slider (.basic-slider)
5. lightGallery + mousewheel - for portfolio lightbox
6. imagesLoaded - dependency for Cube Portfolio
7. Cube Portfolio - for portfolio grid (#cube-grid-mosaic)
8. scrollUp - for back-to-top button

**Extraction pattern:** Each plugin in plugins.js is marked with:
```
/*-----------------------------------------------------------------------------------*/
/*	NN. PLUGIN NAME
/*-----------------------------------------------------------------------------------*/
```

Copy each plugin block completely, including minified code and any modifications below it.

**DO NOT include:** AOS, Plyr, Progressbar, Countdown, Counter Up, Prettify, Video Wrapper, Lazy Maps, Vanilla Form, Isotope, jFlickrFeed, Typer, Cocoen, Slide Portfolio, Backstretch, iScroll, Footer Reveal, CollagePlus, Picturefill, Waypoints.

**Add header comment:**
```javascript
/**
 * Custom Plugins Bundle - Cassie Cay Photography
 * Extracted from plugins.js - only includes plugins used by the site
 *
 * Includes:
 * - SmartMenus (navbar)
 * - Headhesive (sticky header)
 * - jQuery Easing (smooth scroll)
 * - Swiper (quote slider)
 * - lightGallery + mousewheel (portfolio lightbox)
 * - imagesLoaded (Cube Portfolio dependency)
 * - Cube Portfolio (portfolio grid)
 * - scrollUp (back to top)
 *
 * Phase 7 JavaScript Cleanup - Created 2026-01-20
 */
```
  </action>
  <verify>File exists at style/js/custom-plugins.js with significantly smaller size than original plugins.js (target: <250KB vs 547KB original)</verify>
  <done>custom-plugins.js contains only the 8 required plugin groups, properly ordered, with header comment</done>
</task>

<task type="auto">
  <name>Task 2: Create custom-scripts.js with only used initializations</name>
  <files>style/js/custom-scripts.js</files>
  <action>
Extract ONLY used initialization code from scripts.js into a new custom-scripts.js file.

**Keep these sections (preserve the conditional checks):**
1. STICKY HEADER (Headhesive) - lines ~6-23
2. HAMBURGER MENU ICON - lines ~27-33
3. SWIPER basic-slider only - lines ~37-57 (the first `.basic-slider.each()` block)
4. IMAGE ICON HOVER (overlay) - around line 1207
5. LIGHTGALLERY - lines ~1308-1323
6. CUBE PORTFOLIO mosaic only (#cube-grid-mosaic) - lines ~1502-1545
7. BACKGROUND IMAGE - lines ~1672-1675
8. GO TO TOP (scrollUp) - lines ~1679-1705
9. PARALLAX MOBILE - lines ~1709-1711
10. ONEPAGE HEADER OFFSET - lines ~1740-1751
11. ONEPAGE NAV LINKS - lines ~1755-1758
12. SMOOTH SCROLL - lines ~1762-1785

**DO NOT include:**
- All other Swiper configurations (swiper-col3, swiper-col4, etc.)
- Revolution Slider initializations (#slider2 through #slider17, #slider-carousel)
  - NOTE: The #slider initialization is in Revolution Slider's own scripts, NOT in scripts.js
- jFlickrFeed configurations
- Countdown, Counter Up, AOS, Cocoen, Plyr, Progressbar
- Video Wrapper
- Tooltip/Popover
- Other Cube Portfolio configurations (cube-grid, cube-grid-4col, etc.)
- Isotope
- Prettify
- CollagePlus
- Footer Reveal
- Page Loading overlay
- VanillaForm

**Wrap in document ready:**
```javascript
/**
 * Custom Scripts - Cassie Cay Photography
 * Extracted from scripts.js - only includes initializations used by the site
 *
 * Phase 7 JavaScript Cleanup - Created 2026-01-20
 */
$(document).ready(function() {
    'use strict';

    // ... extracted code ...
});
```

**Preserve section comments** for maintainability (the `/*---*/` dividers with section names).
  </action>
  <verify>File exists at style/js/custom-scripts.js with significantly smaller size than original scripts.js (target: <30KB vs 61KB original)</verify>
  <done>custom-scripts.js contains only the 12 required initialization blocks, properly wrapped in document.ready</done>
</task>

<task type="auto">
  <name>Task 3: Wire new files into build and HTML</name>
  <files>vite.config.js, index.html</files>
  <action>
**Update vite.config.js:**
Replace the static copy targets for plugins.js and scripts.js with the new custom files:

Change:
```javascript
{
  src: 'style/js/plugins.js',
  dest: 'style/js'
},
{
  src: 'style/js/scripts.js',
  dest: 'style/js'
},
```

To:
```javascript
{
  src: 'style/js/custom-plugins.js',
  dest: 'style/js'
},
{
  src: 'style/js/custom-scripts.js',
  dest: 'style/js'
},
```

**Update index.html:**
Find the script tags near the end of the file that load plugins.js and scripts.js. Update them to reference the new files:

Change:
```html
<script src="style/js/plugins.js"></script>
<script src="style/js/scripts.js"></script>
```

To:
```html
<script src="style/js/custom-plugins.js"></script>
<script src="style/js/custom-scripts.js"></script>
```

**Verify load order remains:** jQuery -> Popper -> Bootstrap -> Revolution Slider scripts -> custom-plugins.js -> custom-scripts.js

**Do NOT delete original files** - keep plugins.js and scripts.js for reference/rollback. They won't be included in the build since they're not in the static copy targets.
  </action>
  <verify>
Run: `npm run build && npm run preview`
- Build succeeds without errors
- Site loads in browser
- Open browser DevTools Console - no JavaScript errors
  </verify>
  <done>Build system copies new custom files, HTML references new files, site builds and runs without errors</done>
</task>

</tasks>

<verification>
After all tasks complete, verify the full must-haves:

1. **Bundle size reduction:**
   - Check file sizes: `ls -la style/js/custom-*.js`
   - custom-plugins.js should be <250KB (vs 547KB original) = 54%+ reduction
   - custom-scripts.js should be <30KB (vs 61KB original) = 50%+ reduction
   - Combined: <280KB vs 608KB original = 54%+ reduction (meets 30% target)

2. **Functionality preserved:**
   - Run `npm run preview` and test in browser:
   - [ ] Navbar dropdowns work (SmartMenus)
   - [ ] Sticky header activates after scrolling 350px (Headhesive)
   - [ ] Hamburger menu toggles on mobile viewport
   - [ ] Quote slider cycles testimonials (Swiper)
   - [ ] Portfolio grid displays and filters work (Cube Portfolio)
   - [ ] Clicking portfolio images opens lightbox (lightGallery)
   - [ ] Lightbox navigation works with arrows and mousewheel
   - [ ] Back-to-top button appears after scrolling (scrollUp)
   - [ ] Smooth scroll to sections when clicking nav links

3. **No console errors:**
   - Open DevTools Console, reload page
   - Scroll through entire page
   - Click all interactive elements
   - No JavaScript errors in console

4. **Revolution Slider unchanged:**
   - Hero slider still works (this uses Revolution Slider, not our scripts)
   - Confirm no modifications to style/revolution/ directory
</verification>

<success_criteria>
- [ ] custom-plugins.js exists and is <250KB
- [ ] custom-scripts.js exists and is <30KB
- [ ] Combined JS reduction is at least 30% (from 608KB to <425KB - we target <280KB)
- [ ] All 7 observable truths verified (navbar, sticky header, hamburger, swiper, cube portfolio, lightbox, smooth scroll)
- [ ] Zero JavaScript console errors
- [ ] Build completes successfully
- [ ] Revolution Slider untouched and working
</success_criteria>

<output>
After completion, create `.planning/phases/07-javascript-cleanup/07-01-SUMMARY.md`
</output>
