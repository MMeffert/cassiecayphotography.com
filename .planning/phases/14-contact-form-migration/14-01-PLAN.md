---
phase: 14-contact-form-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
autonomous: false

must_haves:
  truths:
    - "User can submit contact form and sees success message"
    - "Invalid input shows validation feedback before submission"
    - "reCAPTCHA token is generated and sent with form data"
    - "Network/server errors display user-friendly error message"
    - "Button shows loading state during submission"
  artifacts:
    - path: "index.html"
      provides: "submitToAPI() function using fetch API"
      contains: "fetch("
    - path: "index.html"
      provides: "Vanilla JS DOM operations"
      not_contains: "$(\"#"
  key_links:
    - from: "submitToAPI()"
      to: "Lambda endpoint"
      via: "fetch POST with JSON"
      pattern: "fetch\\(['\"]https://7qcdrfk7"
    - from: "submitToAPI()"
      to: "reCAPTCHA Enterprise"
      via: "grecaptcha.enterprise.execute"
      pattern: "grecaptcha\\.enterprise\\.execute"
---

<objective>
Convert contact form from jQuery AJAX to vanilla JavaScript fetch API.

Purpose: Remove jQuery dependency from contact form, one of the last jQuery usages before complete removal in Phase 15.

Output: Updated `submitToAPI()` function using fetch API, `document.getElementById()`, and native DOM methods. Same UX preserved (button states, success/error messages).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-contact-form-migration/14-RESEARCH.md

Key patterns from research:
- fetch() does NOT reject on HTTP errors - must check response.ok
- Content-Type header required for JSON POST
- Use async/await with try/catch/finally
- Generate reCAPTCHA token immediately before fetch (tokens expire)
- Build data object BEFORE clearing form (avoid reading empty values)
- Use form.reset() instead of clearing individual fields
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert submitToAPI to fetch API</name>
  <files>index.html (lines 8-74)</files>
  <action>
Replace the entire `submitToAPI()` function in the `<head>` section with vanilla JavaScript:

1. **Replace jQuery selectors with native DOM:**
   - `$("#name").val()` -> `document.getElementById('name').value`
   - `$("#mail").val()` -> `document.getElementById('mail').value`
   - `$("#subject").val()` -> `document.getElementById('subject').value`
   - `$("#comment").val()` -> `document.getElementById('comment').value`
   - `$("#submitmessage")` -> `document.getElementById('submitmessage')`
   - `$("#message")` -> `document.getElementById('message')`

2. **Replace $.ajax with fetch:**
```javascript
const response = await fetch(
    'https://7qcdrfk7uctpaqw36i5z2kwxha0rgrnx.lambda-url.us-east-1.on.aws/',
    {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    }
);
if (!response.ok) {
    throw new Error(`Server error: ${response.status}`);
}
```

3. **Replace jQuery property methods:**
   - `.prop('disabled', true)` -> `.disabled = true`
   - `.text('Sending...')` -> `.textContent = 'Sending...'`
   - `.css('color', 'green')` -> `.style.color = 'green'`

4. **Use async/await with try/catch/finally:**
   - Wrap reCAPTCHA execute in Promise for await
   - Put button re-enable in `finally` block (always runs)
   - Handle errors in `catch` block

5. **Use form.reset() instead of clearing fields individually:**
   - Replace 4 `document.getElementById('x').value = ''` lines with `form.reset()`

6. **Keep validation logic:**
   - Preserve name regex check (2+ chars)
   - Preserve email regex check
   - Use alert() for validation (matches current behavior)

CRITICAL: The function must remain in the `<head>` section because the button uses `onClick="submitToAPI(event)"`.

See 14-RESEARCH.md "Complete Migration Pattern" for reference implementation.
  </action>
  <verify>
Run: `grep -c '\$(' index.html` - should return 0 (no jQuery selectors)
Run: `grep 'fetch(' index.html` - should show fetch call
Run: `grep '$.ajax' index.html` - should return nothing
  </verify>
  <done>
submitToAPI() function uses fetch API and native DOM methods. Zero jQuery calls in contact form code.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Contact form converted from jQuery AJAX to vanilla JS fetch API</what-built>
  <how-to-verify>
1. Run `npm run dev` to start local server
2. Open http://localhost:5173 in browser
3. Scroll to contact section at bottom of page
4. Test validation:
   - Submit with empty name -> should show alert "Name can not less than 2 char"
   - Submit with invalid email -> should show alert "Please enter valid email address"
5. Test successful submission:
   - Fill all fields with valid data (name: "Test", email: "test@example.com", subject: "Test", message: "Hello")
   - Click "Send Message"
   - Button should show "Sending..." and be disabled
   - After ~1-2 seconds, should show green "Message Sent Successfully"
   - Form fields should clear
   - Button should return to "Send Message"
6. Open browser DevTools Network tab:
   - Submit form again
   - Should see POST request to lambda-url.us-east-1.on.aws
   - Request payload should contain all form fields + recaptchaToken
7. Check console for any JavaScript errors
  </how-to-verify>
  <resume-signal>Type "approved" if form works correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- `grep -c '\$(' index.html | head -1` returns a number (may be other jQuery in custom-scripts.js reference, but contact form code should have 0)
- `grep 'submitToAPI' index.html` shows async function with fetch
- Form submission works with success/error feedback
- reCAPTCHA token included in POST payload
- No console errors
</verification>

<success_criteria>
1. Contact form submits successfully using fetch API
2. Validation prevents invalid submissions (name too short, invalid email)
3. Button shows "Sending..." during submission, re-enables after
4. Success message displays in green, error in red
5. Form fields clear on successful submission
6. reCAPTCHA Enterprise integration preserved
7. Zero jQuery calls in submitToAPI() function
</success_criteria>

<output>
After completion, create `.planning/phases/14-contact-form-migration/14-01-SUMMARY.md`
</output>
